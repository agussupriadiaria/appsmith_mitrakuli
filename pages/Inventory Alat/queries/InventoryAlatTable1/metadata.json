{
  "gitSyncId": "67a5c50a93de7f15bb3860ab_35e94a3d-6471-478a-a55e-3a0e7127607e",
  "id": "Inventory Alat_InventoryAlatTable1",
  "pluginId": "mysql-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "SELECT \n    ROW_NUMBER() OVER (ORDER BY inv.id ASC) AS no, -- Menambahkan nomor urut berdasarkan ID secara ascending\n    inv.id, -- ID produk\n    inv.item, -- Nama produk\n    inv.price, -- Harga produk\n    GREATEST(\n        CASE \n            WHEN sewa.complete_count > 0 THEN 1 -- Jika ada penyewaan dengan status Complete, stok dikembalikan menjadi 1\n            ELSE inv.stock - COALESCE(sewa.total_sku, 0) -- Jika tidak, hitung stok seperti biasa\n        END, \n        0\n    ) AS stock, -- Menghitung stok yang tersisa setelah dikurangi jumlah yang disewa\n    -- COALESCE(sewa.total_sku, 0) memastikan jika total_sku bernilai NULL, maka dianggap 0\n    -- inv.stock - COALESCE(sewa.total_sku, 0) menghitung stok yang tersisa setelah dikurangi jumlah yang disewa\n    -- GREATEST(..., 0) memastikan stok tidak menjadi negatif, jika hasil pengurangan di bawah 0, maka diubah menjadi 0\n    inv.sku, -- SKU produk\n    inv.merk -- Merek produk\nFROM (\n    SELECT \n        wp_posts.ID AS id, -- Mengambil ID dari tabel wp_posts\n        wp_posts.post_title AS item, -- Mengambil nama produk dari kolom post_title\n        wp_postmeta_price.meta_value AS price, -- Mengambil harga produk dari meta_value\n        CAST(wp_postmeta_stock.meta_value AS SIGNED) AS stock, -- Mengonversi stok ke tipe numerik (SIGNED INT)\n        CONVERT(wp_postmeta_sku.meta_value USING utf8mb4) AS sku, -- Konversi SKU ke collation utf8mb4\n        MAX(wp_terms.name) AS merk -- Mengambil nama merek produk\n    FROM \n        wp_posts\n    LEFT JOIN \n        wp_postmeta AS wp_postmeta_price \n        ON wp_posts.ID = wp_postmeta_price.post_id AND wp_postmeta_price.meta_key = '_price' -- Menghubungkan harga produk\n    LEFT JOIN \n        wp_postmeta AS wp_postmeta_stock \n        ON wp_posts.ID = wp_postmeta_stock.post_id AND wp_postmeta_stock.meta_key = '_stock' -- Menghubungkan stok produk\n    LEFT JOIN \n        wp_postmeta AS wp_postmeta_sku \n        ON wp_posts.ID = wp_postmeta_sku.post_id AND wp_postmeta_sku.meta_key = '_sku' -- Menghubungkan SKU produk\n    INNER JOIN  \n        wp_term_relationships ON wp_posts.ID = wp_term_relationships.object_id -- Menghubungkan ke tabel hubungan kategori\n    INNER JOIN  \n        wp_term_taxonomy ON wp_term_relationships.term_taxonomy_id = wp_term_taxonomy.term_taxonomy_id \n        AND wp_term_taxonomy.taxonomy = 'product_brand' -- Memfilter hanya taxonomy dengan kategori 'product_brand'\n    INNER JOIN  \n        wp_terms ON wp_term_taxonomy.term_id = wp_terms.term_id -- Menghubungkan ke tabel merek\n    WHERE \n        wp_posts.post_type IN ('product', 'product_variation') -- Memfilter hanya produk dan variasinya\n        AND wp_postmeta_sku.meta_value != '' -- Mengabaikan produk tanpa SKU\n    GROUP BY \n        wp_posts.ID, wp_posts.post_title, wp_postmeta_price.meta_value,\n        wp_postmeta_stock.meta_value, wp_postmeta_sku.meta_value -- Pengelompokan untuk memastikan data unik\n) AS inv\nLEFT JOIN (\n    SELECT \n        CONVERT(rent_sku USING utf8mb4) AS sku, -- Konversi SKU yang disewa ke utf8mb4\n        COUNT(*) AS total_sku, -- Menghitung total SKU yang disewa\n        SUM(CASE WHEN rent_status = 'Complete' THEN 1 ELSE 0 END) AS complete_count -- Menghitung jumlah penyewaan dengan status Complete\n    FROM \n        wp_postrent_log \n    GROUP BY rent_sku -- Mengelompokkan berdasarkan SKU yang disewa\n) AS sewa ON inv.sku = sewa.sku -- Menghubungkan data stok dengan jumlah penyewaan berdasarkan SKU\nORDER BY inv.id ASC; -- Mengurutkan hasil berdasarkan ID produk\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "Mitrakuli-Database",
      "isAutoGenerated": false,
      "name": "Mitrakuli-Database",
      "pluginId": "mysql-plugin"
    },
    "dynamicBindingPathList": [],
    "executeOnLoad": true,
    "name": "InventoryAlatTable1",
    "pageId": "Inventory Alat",
    "userSetOnLoad": false
  }
}