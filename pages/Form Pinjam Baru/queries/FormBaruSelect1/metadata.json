{
  "gitSyncId": "67a5c50a93de7f15bb3860ab_69a70039-4cd8-4fb3-952a-7c79d7cd0fab",
  "id": "Form Pinjam Baru_FormBaruSelect1",
  "pluginId": "mysql-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "-- Query untuk elemen Select1 di Form1 Appsmith\nSELECT\n    -- Menggabungkan beberapa informasi produk menjadi satu string untuk tampilan\n    CONCAT(wp_posts.ID, ' | ', wp_postmeta.meta_value, ' | ', wp_posts.post_title, ' | ', MAX(wp_terms.name), ' | ', COALESCE(inv.stock, 0)) AS sku_product,\n    wp_posts.ID AS post_id, -- ID dari post produk\n    wp_postmeta.meta_value AS meta_value, -- SKU produk\n    wp_postmeta_price.meta_value AS price, -- Harga produk\n    COALESCE(inv.stock, 0) AS stock -- Jumlah stok produk setelah perhitungan dari InventoryAlatTable1\nFROM wp_posts  \n-- Join dengan wp_postmeta untuk mendapatkan SKU produk\nLEFT JOIN wp_postmeta ON wp_posts.ID = wp_postmeta.post_id AND wp_postmeta.meta_key = '_sku'  \n-- Join dengan wp_postmeta untuk mendapatkan harga produk\nLEFT JOIN wp_postmeta AS wp_postmeta_price ON wp_posts.ID = wp_postmeta_price.post_id AND wp_postmeta_price.meta_key = '_price'\n-- Menghubungkan dengan kategori \"product_brand\"\nINNER JOIN wp_term_relationships ON wp_posts.ID = wp_term_relationships.object_id  \nINNER JOIN wp_term_taxonomy ON wp_term_relationships.term_taxonomy_id = wp_term_taxonomy.term_taxonomy_id \n    AND wp_term_taxonomy.taxonomy = 'product_brand'  \nINNER JOIN wp_terms ON wp_term_taxonomy.term_id = wp_terms.term_id  \n-- Join dengan subquery InventoryAlatTable1 untuk mendapatkan stok berdasarkan SKU\nLEFT JOIN (\n    SELECT \n        CONVERT(inv.sku USING utf8mb4) COLLATE utf8mb4_general_ci AS sku, \n        GREATEST(inv.stock - COALESCE(sewa.total_sku, 0), 0) AS stock -- Menghitung stok yang tersedia setelah dikurangi yang disewa dengan rent_status 'Incomplete'\n    FROM (\n        -- Subquery untuk mengambil stok dari wp_postmeta\n        SELECT \n            CONVERT(wp_postmeta_sku.meta_value USING utf8mb4) COLLATE utf8mb4_general_ci AS sku, \n            CAST(wp_postmeta_stock.meta_value AS SIGNED) AS stock -- Mengubah stok menjadi tipe numerik\n        FROM wp_posts\n        LEFT JOIN wp_postmeta AS wp_postmeta_stock \n            ON wp_posts.ID = wp_postmeta_stock.post_id AND wp_postmeta_stock.meta_key = '_stock'\n        LEFT JOIN wp_postmeta AS wp_postmeta_sku \n            ON wp_posts.ID = wp_postmeta_sku.post_id AND wp_postmeta_sku.meta_key = '_sku'\n        WHERE wp_posts.post_type IN ('product', 'product_variation')\n    ) AS inv\n    -- Menghitung total unit SKU yang sedang disewa dengan rent_status 'Incomplete'\n    LEFT JOIN (\n        SELECT \n            CONVERT(rent_sku USING utf8mb4) COLLATE utf8mb4_general_ci AS sku, \n            COUNT(*) AS total_sku -- Jumlah unit SKU yang sedang disewa\n        FROM wp_postrent_log \n        WHERE rent_status = 'Incomplete' -- Hanya menghitung stok yang masih dalam status 'Incomplete'\n        GROUP BY rent_sku\n    ) AS sewa ON inv.sku = sewa.sku\n) AS inv ON CONVERT(wp_postmeta.meta_value USING utf8mb4) COLLATE utf8mb4_general_ci = inv.sku\n-- Filter hanya untuk produk dan variasi produk yang memiliki SKU\nWHERE wp_posts.post_type IN ('product', 'product_variation')\n      AND wp_postmeta.meta_value != ''\n-- Mengelompokkan hasil berdasarkan informasi produk utama\nGROUP BY wp_posts.ID, wp_postmeta.meta_value, wp_posts.post_title, wp_postmeta_price.meta_value, inv.stock;\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "Mitrakuli-Database",
      "isAutoGenerated": false,
      "name": "Mitrakuli-Database",
      "pluginId": "mysql-plugin"
    },
    "dynamicBindingPathList": [],
    "executeOnLoad": true,
    "name": "FormBaruSelect1",
    "pageId": "Form Pinjam Baru",
    "userSetOnLoad": false
  }
}